{"ast":null,"code":"var _jsxFileName = \"/Users/karentovar/Documents/WebCitas/WebCitas/frontend/src/pages/Project/AvailabilityEdit.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from 'react';\nimport { Grid } from '@material-ui/core';\nimport Controls from \"../../components/controls/Controls\";\nimport { useForm, Form } from '../../components/useForm';\nimport { Paper, makeStyles, Box } from '@material-ui/core';\nimport EcoIcon from '@material-ui/icons/Eco';\nimport PageHeader from \"../../components/PageHeader\";\nimport CircularStatic from '../../components/CircularStatic';\nimport axios from 'axios';\nimport { useParams } from 'react-router-dom';\nimport AlertMessage from '../../components/AlertMessage';\nimport ImageComponent from '../../components/ImageComponent';\nimport MenuItem from '@mui/material/MenuItem';\nimport CalendarTemplate from './Calendar';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst initialBValues = {\n  name: '',\n  description: '',\n  objetives: '',\n  isTimeSeries: false,\n  image: '',\n  programs: [],\n  factors: [],\n  laboratorio: '',\n  availability: ['No hay espacios disponibles']\n};\nconst useStyles = makeStyles(theme => ({\n  pageContent: {\n    margin: '50px 0 0 0',\n    width: '90%',\n    padding: theme.spacing(3)\n  },\n  programholder: {\n    height: 40,\n    textAlign: 'center',\n    width: '90%'\n  },\n  sizeAvatar: {\n    height: \"150px\",\n    width: \"150px\",\n    marginBottom: \"25px\"\n  },\n  imageButton: {\n    marginBottom: \"25px\"\n  }\n}));\nexport default function AvailabilityEdit() {\n  _s();\n\n  let [availability, setAvailability] = useState([]);\n  let project = null;\n  const [labName, setLabName] = useState('');\n  const {\n    id\n  } = useParams();\n  const classes = useStyles();\n  const [loading, setLoading] = React.useState(false);\n  const [open, setOpen] = React.useState(false);\n  const [error, setError] = useState('');\n  const [progress, setProgress] = useState(0);\n  const message = id ? \"Se ha actualizado el servicio!\" : \"Se ha guardado el servicio!\";\n  const title = id ? \"Actualizar servicio\" : \"Añadir nuevo servicio\";\n  const type = id ? \"actualizar\" : \"agregar\";\n  const Calendar = CalendarTemplate({\n    availability,\n    setAvailability: update => {\n      setAvailability(update);\n      saveAvailability(update);\n      console.log(\"CRAYOLA\");\n      console.log(availability);\n      getProject();\n      console.log(project);\n      updateProjectAvailability(availability);\n    }\n  });\n\n  const validate = function () {\n    let fieldValues = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : values;\n    let temp = { ...errors\n    };\n    if ('name' in fieldValues) temp.name = fieldValues.name ? \"\" : \"Este campo es obligatorio.\";\n    if ('description' in fieldValues) temp.description = fieldValues.description ? \"\" : \"Este campo es obligatorio.\";\n    if ('objetives' in fieldValues) temp.objetives = fieldValues.objetives ? \"\" : \"Este campo es obligatorio.\";\n    setErrors({ ...temp\n    });\n    if (fieldValues === values) return Object.values(temp).every(x => x === \"\");\n  };\n\n  useEffect(() => {\n    let unmounted = false;\n    if (id) getProject();\n    return () => {\n      unmounted = true;\n    };\n  }, []);\n  const config = {\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: `Bearer ${localStorage.getItem(\"authToken\")}`\n    },\n    onUploadProgress: data => {\n      //Set the progress value to show the progress bar\n      setProgress(Math.round(100 * data.loaded / data.total));\n    }\n  };\n\n  function setProject(projectParam) {\n    project = projectParam;\n  }\n\n  const getProject = async () => {\n    setLoading(true);\n\n    try {\n      let response = await axios.get(`${process.env.REACT_APP_API_URL}/api/private/project/${id}`, {\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${localStorage.getItem(\"authToken\")}`\n        },\n        onDownloadProgress: data => {\n          //Set the progress value to show the progress bar                    \n          setProgress(Math.round(100 * data.loaded / data.total));\n        }\n      });\n      setProject(response.data.project);\n      setValues(response.data.project);\n      setLoading(false);\n    } catch (error) {\n      setTimeout(() => {\n        setOpen(false);\n        setTimeout(() => {\n          setError(\"\");\n        }, 2000);\n      }, 5000);\n      setOpen(true);\n      setLoading(false);\n      return setError(\"Authentication failed!\");\n    }\n  };\n\n  useEffect(async () => {\n    let unmounted = false;\n    await getLabName();\n    return () => {\n      unmounted = true;\n    };\n  }, []);\n\n  const getLabName = async () => {\n    try {\n      const uid = localStorage.getItem(\"uid\");\n      let response = await axios.get(`${process.env.REACT_APP_API_URL}/api/private/users/${uid}`, config);\n      console.log(\"WENAAAS\");\n      console.log(response);\n      values.laboratorio = response.data.user.roles[0].projectName;\n      setLabName(response.data.user.roles[0].projectName);\n    } catch (error) {\n      console.log(\"Wenuuuski\");\n    }\n  };\n\n  const {\n    values,\n    avaValues,\n    setValues,\n    errors,\n    setErrors,\n    handleInputChange,\n    resetForm\n  } = useForm(initialBValues, true, validate);\n\n  const confirmPost = () => {\n    setOpen(true);\n    setLoading(false);\n\n    if (!id) {\n      resetForm({});\n    }\n\n    setTimeout(function () {\n      setOpen(false);\n    }, 6000);\n  };\n\n  function updateProjectAvailability(availabilityParam) {\n    console.log(\"UPDATE\");\n    console.log(availabilityParam);\n    const value = {\n      availability: availabilityParam\n    };\n    console.log(\"AVAILABILITY\");\n    console.log(availabilityParam);\n    console.log(project);\n    axios.patch(`${process.env.REACT_APP_API_URL}/api/private/project/availability/${id}`, value, config);\n    console.log(\"AFTER\");\n  }\n\n  function saveAvailability(update) {\n    console.log(\"LOGGING\");\n    console.log(update);\n    availability = update;\n    createAvailability();\n  }\n\n  const createAvailability = async e => {\n    console.log(\"OLIS\");\n    console.log(availability);\n\n    if (validate()) {\n      setLoading(true);\n      availability.forEach(element => {\n        const avaValue = {\n          service: id,\n          start: element.start,\n          end: element.end,\n          timeSlot: 30\n        };\n\n        try {\n          if (id) {\n            axios.post(`${process.env.REACT_APP_API_URL}/api/private/availability/${id}`, avaValue, config).then(confirmPost);\n          } else {\n            axios.patch(`${process.env.REACT_APP_API_URL}/api/private/availability`, avaValue, config).then(confirmPost);\n          }\n\n          console.log(\"CREADO\");\n        } catch (error) {\n          setLoading(false);\n          setTimeout(() => {\n            setTimeout(() => {\n              setError(\"\");\n            }, 2000);\n          }, 5000);\n          return setError(\"Authentication failed!\");\n        }\n      });\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(PageHeader, {\n      title: title,\n      subTitle: `Formulario para ${type} un servicio`,\n      icon: /*#__PURE__*/_jsxDEV(EcoIcon, {\n        fontSize: \"large\",\n        color: \"primary\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 266,\n        columnNumber: 23\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 263,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(CircularStatic, {\n      progress: progress,\n      hidden: !loading\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 269,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Paper, {\n      className: classes.pageContent,\n      children: /*#__PURE__*/_jsxDEV(ImageComponent, {\n        initialValues: values,\n        onChange: handleInputChange\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 271,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 270,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Grid, {\n      container: true,\n      direction: \"row\",\n      justifyContent: \"center\",\n      alignItems: \"center\",\n      style: {\n        marginTop: '20px'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(Calendar, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 282,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 281,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 274,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 262,\n    columnNumber: 9\n  }, this);\n}\n\n_s(AvailabilityEdit, \"l901EOZtuHYs4piUKrohMjzuzzA=\", false, function () {\n  return [useParams, useStyles, useForm];\n});\n\n_c = AvailabilityEdit;\n\nvar _c;\n\n$RefreshReg$(_c, \"AvailabilityEdit\");","map":{"version":3,"sources":["/Users/karentovar/Documents/WebCitas/WebCitas/frontend/src/pages/Project/AvailabilityEdit.js"],"names":["React","useState","useEffect","Grid","Controls","useForm","Form","Paper","makeStyles","Box","EcoIcon","PageHeader","CircularStatic","axios","useParams","AlertMessage","ImageComponent","MenuItem","CalendarTemplate","initialBValues","name","description","objetives","isTimeSeries","image","programs","factors","laboratorio","availability","useStyles","theme","pageContent","margin","width","padding","spacing","programholder","height","textAlign","sizeAvatar","marginBottom","imageButton","AvailabilityEdit","setAvailability","project","labName","setLabName","id","classes","loading","setLoading","open","setOpen","error","setError","progress","setProgress","message","title","type","Calendar","update","saveAvailability","console","log","getProject","updateProjectAvailability","validate","fieldValues","values","temp","errors","setErrors","Object","every","x","unmounted","config","headers","Authorization","localStorage","getItem","onUploadProgress","data","Math","round","loaded","total","setProject","projectParam","response","get","process","env","REACT_APP_API_URL","onDownloadProgress","setValues","setTimeout","getLabName","uid","user","roles","projectName","avaValues","handleInputChange","resetForm","confirmPost","availabilityParam","value","patch","createAvailability","e","forEach","element","avaValue","service","start","end","timeSlot","post","then","marginTop"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\nimport { Grid, } from '@material-ui/core';\nimport Controls from \"../../components/controls/Controls\";\nimport { useForm, Form } from '../../components/useForm';\nimport { Paper, makeStyles, Box } from '@material-ui/core';\nimport EcoIcon from '@material-ui/icons/Eco';\nimport PageHeader from \"../../components/PageHeader\";\nimport CircularStatic from '../../components/CircularStatic'\nimport axios from 'axios';\nimport { useParams } from 'react-router-dom';\nimport AlertMessage from '../../components/AlertMessage';\nimport ImageComponent from '../../components/ImageComponent';\nimport MenuItem from '@mui/material/MenuItem';\nimport CalendarTemplate from './Calendar';\n\n\nconst initialBValues = {\n    name: '',\n    description: '',\n    objetives: '',\n    isTimeSeries: false,\n    image: '',\n    programs: [],\n    factors: [],\n    laboratorio: '',\n    availability: ['No hay espacios disponibles']\n}\n\nconst useStyles = makeStyles(theme => ({\n    pageContent: {\n        margin: '50px 0 0 0',\n        width: '90%',\n        padding: theme.spacing(3)\n    },\n    programholder: {\n        height: 40,\n        textAlign: 'center',\n        width: '90%'\n    },\n    sizeAvatar: {\n        height: \"150px\",\n        width: \"150px\",\n        marginBottom: \"25px\",\n    },\n    imageButton: {\n        marginBottom: \"25px\"\n    },\n}))\n\nexport default function AvailabilityEdit() {\n\n    let [availability, setAvailability] = useState([])\n    let project= null;\n\n    const [labName, setLabName] = useState('');\n    const { id } = useParams();\n    const classes = useStyles();\n    const [loading, setLoading] = React.useState(false);\n    const [open, setOpen] = React.useState(false);\n    const [error, setError] = useState('');\n    const [progress, setProgress] = useState(0);\n    const message = id ? \"Se ha actualizado el servicio!\" : \"Se ha guardado el servicio!\"\n    const title = id ? \"Actualizar servicio\" : \"Añadir nuevo servicio\";\n    const type = id ? \"actualizar\" : \"agregar\";\n\n\n    const Calendar = CalendarTemplate({\n        availability,\n        setAvailability: update => {\n            setAvailability(update)\n            saveAvailability(update)\n            console.log(\"CRAYOLA\")\n            console.log(availability)\n            getProject();\n            console.log(project)\n            updateProjectAvailability(availability)\n        },\n\n\n\n    });\n\n\n    const validate = (fieldValues = values) => {\n        let temp = { ...errors }\n        if ('name' in fieldValues)\n            temp.name = fieldValues.name ? \"\" : \"Este campo es obligatorio.\"\n        if ('description' in fieldValues)\n            temp.description = fieldValues.description ? \"\" : \"Este campo es obligatorio.\"\n        if ('objetives' in fieldValues)\n            temp.objetives = fieldValues.objetives ? \"\" : \"Este campo es obligatorio.\"\n\n\n\n        setErrors({\n            ...temp\n        })\n        if (fieldValues === values)\n            return Object.values(temp).every(x => x === \"\")\n    }\n\n    useEffect(() => {\n        let unmounted = false;\n        if (id)\n            getProject();\n        return () => { unmounted = true; };\n    }, []);\n\n    const config = {\n        headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${localStorage.getItem(\"authToken\")}`,\n        }, onUploadProgress: (data) => {\n            //Set the progress value to show the progress bar\n            setProgress(Math.round((100 * data.loaded) / data.total));\n        },\n    };\n\n    function setProject(projectParam){\n        project = projectParam;\n    }\n    const getProject = async () => {\n        setLoading(true);\n        try {\n            let response = await axios.get(`${process.env.REACT_APP_API_URL}/api/private/project/${id}`, {\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                    Authorization: `Bearer ${localStorage.getItem(\"authToken\")}`,\n                },\n                onDownloadProgress: (data) => {\n                    //Set the progress value to show the progress bar                    \n                    setProgress(Math.round((100 * data.loaded) / data.total));\n                },\n            });\n            setProject(response.data.project);\n            setValues(response.data.project);\n            setLoading(false);\n        } catch (error) {\n            setTimeout(() => {\n                setOpen(false);\n                setTimeout(() => {\n                    setError(\"\");\n                }, 2000);\n\n            }, 5000);\n            setOpen(true);\n            setLoading(false);\n            return setError(\"Authentication failed!\");\n        }\n    }\n\n    useEffect(async () => {\n        let unmounted = false;\n        await getLabName();\n        return () => { unmounted = true };\n    }, []);\n\n    const getLabName = async () => {\n        try {\n            const uid = localStorage.getItem(\"uid\");\n            let response = await axios.get(`${process.env.REACT_APP_API_URL}/api/private/users/${uid}`, config);\n            console.log(\"WENAAAS\");\n            console.log(response);\n            values.laboratorio = response.data.user.roles[0].projectName;\n            setLabName(response.data.user.roles[0].projectName);\n        }\n        catch (error) {\n            console.log(\"Wenuuuski\");\n        }\n\n    }\n\n    const {\n        values,\n        avaValues,\n        setValues,\n        errors,\n        setErrors,\n        handleInputChange,\n        resetForm\n    } = useForm(initialBValues, true, validate);\n\n    const confirmPost = () => {\n        setOpen(true);\n        setLoading(false);\n        if (!id) {\n            resetForm({\n            })\n        }\n        setTimeout(function () {\n            setOpen(false);\n        }, 6000);\n\n    }\n\n\n    function updateProjectAvailability(availabilityParam) {\n        console.log(\"UPDATE\")\n        console.log(availabilityParam)\n        const value= {\n            availability: availabilityParam\n        }\n        console.log(\"AVAILABILITY\");\n        console.log(availabilityParam);\n        console.log(project);\n        \n        axios.patch(`${process.env.REACT_APP_API_URL}/api/private/project/availability/${id}`, value, config);\n        \n        console.log(\"AFTER\")\n        \n    }\n\n    function saveAvailability(update) {\n        console.log(\"LOGGING\")\n        console.log(update)\n        availability = update\n        createAvailability()\n\n    }\n\n    const createAvailability = async e => {\n        console.log(\"OLIS\")\n        console.log(availability)\n        if (validate()) {\n            setLoading(true);\n\n            availability.forEach(element => {\n                const avaValue = {\n                    service: id,\n                    start: element.start,\n                    end: element.end,\n                    timeSlot: 30\n\n                }\n                try {\n                    if (id) {\n                        axios\n                            .post(`${process.env.REACT_APP_API_URL}/api/private/availability/${id}`, avaValue, config)\n                            .then(confirmPost)\n                    } else {\n                        axios\n                            .patch(`${process.env.REACT_APP_API_URL}/api/private/availability`, avaValue, config)\n                            .then(confirmPost)\n                    }\n                    console.log(\"CREADO\")\n\n\n                } catch (error) {\n                    setLoading(false);\n                    setTimeout(() => {\n                        setTimeout(() => {\n                            setError(\"\");\n                        }, 2000);\n                    }, 5000);\n                    return setError(\"Authentication failed!\");\n                }\n            });\n        }\n    }\n    return (\n\n        <div>\n            <PageHeader\n                title={title}\n                subTitle={`Formulario para ${type} un servicio`}\n                icon={<EcoIcon fontSize=\"large\" color='primary'\n                />}\n            />\n            <CircularStatic progress={progress} hidden={!loading} />\n            <Paper className={classes.pageContent}>\n                <ImageComponent initialValues={values} onChange={handleInputChange} />\n\n            </Paper>\n            <Grid\n                container\n                direction=\"row\"\n                justifyContent=\"center\"\n                alignItems=\"center\"\n                style={{ marginTop: '20px' }}\n            >\n                <div>\n                    <Calendar />\n                </div>\n            </Grid>\n        </div>\n    )\n}\n"]},"metadata":{},"sourceType":"module"}